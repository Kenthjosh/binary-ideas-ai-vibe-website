---
interface PainPointCard {
  title: string;
  icon?: string;
  iconSrc?: string;
  iconPath?: string;
  iconAlt?: string;
  description: string;
  pain: string;
}

interface Props {
  titleLeading?: string;
  titleHighlight?: string;
  description?: string;
  cards?: PainPointCard[];
}

const {
  titleLeading = "Pain Points",
  titleHighlight = "You Can't Ignore",
  description = "",
  cards = []
} = Astro.props as Props;
---

{cards.length > 0 && (
  <section class="relative px-6 py-16 sm:px-8 lg:px-20" data-pain-slider-root>
    <div class="mx-auto flex max-w-6xl flex-col gap-10">
      <div class="text-center">
        <h2 class="[font-family:'Segoe_UI_Symbol-Regular',Helvetica] text-3xl font-semibold leading-tight text-white sm:text-4xl md:text-[54px] md:leading-[64px]">
          <span>{titleLeading}</span>
          <span class="text-transparent bg-clip-text bg-[linear-gradient(90deg,#60a5fa_0%,#8b5cf6_100%)]">
            {titleHighlight}
          </span>
        </h2>
        {description && (
          <p class="mt-4 text-base leading-7 text-[#dfe3ef] sm:text-lg [font-family:'Segoe_UI_Symbol-Regular',Helvetica]">
            {description}
          </p>
        )}
      </div>

      <div class="relative">
        <div class="overflow-hidden" data-pain-slider>
          <div class="flex" data-pain-slider-track>
            {cards.map((card) => {
              const iconSrc =
                card.iconSrc ??
                card.iconPath ??
                (typeof card.icon === "string" &&
                /\.(svg|png|jpe?g|gif|webp)$/i.test(card.icon)
                  ? card.icon
                  : undefined);
              const iconAlt = card.iconAlt ?? card.title;

              return (
                <article
                  class="flex w-full flex-shrink-0 px-0 sm:w-1/2 sm:px-2"
                  data-pain-slide
                >
                  <div class="flex h-full w-full flex-col gap-4 rounded-[28px] border border-[#ffffff14] bg-[#fffefe08] p-6 shadow-[0_25px_60px_rgba(0,0,0,0.35)] [backdrop-filter:blur(22px)]">
                    <div class="flex items-center gap-3">
                      <div class="flex h-14 w-14 items-center justify-center rounded-2xl bg-[#ffffff12] text-3xl">
                        {iconSrc ? (
                          <img
                            src={iconSrc}
                            alt={iconAlt}
                            loading="lazy"
                            class="h-10 w-10 object-contain"
                          />
                        ) : (
                          <span>{card.icon}</span>
                        )}
                      </div>
                      <h3 class="[font-family:'Segoe_UI_Symbol-Regular',Helvetica] text-2xl font-semibold text-white">
                        {card.title}
                      </h3>
                    </div>

                    <p class="text-base leading-7 text-[#dfe3ef] sm:text-lg [font-family:'Segoe_UI_Symbol-Regular',Helvetica]">
                      {card.description}
                    </p>

                    <div class="rounded-2xl border border-[#ff65844d] bg-[rgba(255,77,125,0.12)] px-5 py-4 shadow-[0_10px_30px_rgba(255,77,125,0.2)]">
                      <div class="text-xs font-semibold tracking-[0.2em] text-[#ff98b1]">
                        THE PAIN
                      </div>
                      <p class="mt-2 text-sm leading-6 text-[#ffe7ee] sm:text-base [font-family:'Segoe_UI_Symbol-Regular',Helvetica]">
                        {card.pain}
                      </p>
                    </div>
                  </div>
                </article>
              );
            })}
          </div>
        </div>

        <div class="mt-6 flex items-center justify-end gap-3" data-pain-nav>
          <button
            type="button"
            class="flex h-12 w-12 items-center justify-center rounded-full border border-white/20 bg-white/5 text-white transition hover:bg-white/20"
            data-pain-prev
            aria-label="Previous pain points"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5">
              <path d="M15 18l-6-6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <button
            type="button"
            class="flex h-12 w-12 items-center justify-center rounded-full border border-white/20 bg-white/5 text-white transition hover:bg-white/20"
            data-pain-next
            aria-label="Next pain points"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" class="h-5 w-5">
              <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </section>
)}

<script is:inline>
  (() => {
    const sliders = document.querySelectorAll('[data-pain-slider-root]');
    const mediaQuery = window.matchMedia('(min-width: 640px)');

    sliders.forEach((slider) => {
      const sliderViewport = slider.querySelector('[data-pain-slider]');
      const track = slider.querySelector('[data-pain-slider-track]');
      const nav = slider.querySelector('[data-pain-nav]');
      if (!sliderViewport || !track) return;

      let slides = Array.from(track.querySelectorAll('[data-pain-slide]'));
      const originalCount = slides.length;
      if (originalCount <= 1) {
        nav?.classList.add('hidden');
        return;
      }

      const maxVisible = Math.min(2, originalCount);

      const cloneSlides = (elements) => elements.map((slide) => slide.cloneNode(true));
      const prependClones = cloneSlides(slides.slice(-maxVisible)).reverse();
      const appendClones = cloneSlides(slides.slice(0, maxVisible));
      prependClones.forEach((clone) => track.insertBefore(clone, track.firstChild));
      appendClones.forEach((clone) => track.appendChild(clone));

      slides = Array.from(track.querySelectorAll('[data-pain-slide]'));

      const prevButton = slider.querySelector('[data-pain-prev]');
      const nextButton = slider.querySelector('[data-pain-next]');

      let visibleCount = mediaQuery.matches ? Math.min(2, originalCount) : 1;
      let currentIndex = maxVisible;
      let isAnimating = false;

      const getSlideWidth = () => (visibleCount === 1 ? 100 : 50);

      const updatePosition = (instant = false) => {
        track.style.transitionDuration = instant ? '0ms' : '500ms';
        track.style.transform = `translateX(-${currentIndex * getSlideWidth()}%)`;
      };

      const clampIndex = () => {
        if (currentIndex >= originalCount + maxVisible) {
          currentIndex -= originalCount;
          updatePosition(true);
        } else if (currentIndex < maxVisible) {
          currentIndex += originalCount;
          updatePosition(true);
        }
      };

      const handleResize = () => {
        const newVisible = mediaQuery.matches ? Math.min(2, originalCount) : 1;
        if (newVisible !== visibleCount) {
          visibleCount = newVisible;
          updatePosition(true);
        }
      };

      mediaQuery.addEventListener('change', handleResize);
      window.addEventListener('resize', handleResize);

      track.addEventListener('transitionend', () => {
        isAnimating = false;
        clampIndex();
      });

      const move = (direction) => {
        if (isAnimating) return;
        isAnimating = true;
        currentIndex += direction * visibleCount;
        updatePosition();
      };

      prevButton?.addEventListener('click', () => move(-1));
      nextButton?.addEventListener('click', () => move(1));

      updatePosition(true);
    });
  })();
</script>

